<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Product Details | Ultra Nutritions Sri Lanka</title>
    <meta name="description" content="Buy authentic bodybuilding supplements in Sri Lanka at Ultra Nutritions. Best prices and island-wide delivery.">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <style>
        :root { --primary-color: #e63946; --dark-color: #1a1a1a; --bg-color: #f8f9fa; --text-dark: #333; --border-color: #eaeaea;}
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Poppins', sans-serif; background-color: white; margin: 0; padding: 0; color: var(--text-dark); min-height: 100vh; display: flex; flex-direction: column; }
        
        /* --- Standardized Header --- */
        header { background-color: var(--dark-color); padding: 20px 15px; text-align: center; position: sticky; top: 0; z-index: 100; }
        .header-link { text-decoration: none; color: white; display: inline-block;}
        header h1 { margin: 0; font-size: 26px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;}
        header h1 span { color: var(--primary-color); }
        .header-tagline { color: #aaa; font-size: 12px; margin: 5px 0 0 0; font-weight: 400; }
        
        .container { width: 100%; max-width: 1200px; margin: 30px auto; padding: 0 20px; flex-grow: 1;}
        
        .breadcrumb { display: inline-flex; align-items: center; gap: 8px; color: #666; text-decoration: none; font-size: 14px; margin-bottom: 25px; font-weight: 500; transition: 0.2s;}
        .breadcrumb:hover { color: var(--primary-color); }

        /* --- Professional Product Layout --- */
        .product-layout { display: flex; gap: 40px; align-items: flex-start; }

        /* Image Gallery Section (Amazon Style) */
        .product-gallery { display: flex; gap: 15px; width: 50%; max-width: 550px; }
        .thumbnail-list { display: flex; flex-direction: column; gap: 10px; width: 70px; }
        .thumbnail { width: 100%; aspect-ratio: 1; border: 1px solid var(--border-color); border-radius: 6px; cursor: pointer; padding: 5px; background: #fff; transition: 0.2s;}
        .thumbnail:hover, .thumbnail.active { border-color: var(--primary-color); box-shadow: 0 0 5px rgba(230,57,70,0.3); }
        .thumbnail img { width: 100%; height: 100%; object-fit: contain; }

        .main-image-container { flex: 1; border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; background: #fff; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; aspect-ratio: 1; cursor: crosshair;}
        .main-image-container img { width: 100%; height: 100%; object-fit: contain; transition: transform 0.1s ease-out; transform-origin: center center; }

        /* Product Info Section */
        .product-info { flex: 1; display: flex; flex-direction: column; }
        .cat-badge { display: inline-block; background: #f0f0f0; padding: 5px 12px; border-radius: 5px; font-size: 11px; font-weight: 700; color: #555; text-transform: uppercase; margin-bottom: 12px; width: fit-content; }
        
        .product-info h1 { margin: 0 0 15px 0; font-size: 30px; font-weight: 800; color: #111; line-height: 1.2; }
        
        .price-section { padding: 15px 0; border-top: 1px solid var(--border-color); border-bottom: 1px solid var(--border-color); margin-bottom: 25px; display: flex; align-items: center; gap: 20px; }
        .price { font-size: 28px; color: var(--primary-color); font-weight: 800; margin: 0; }
        .status-badge { padding: 6px 15px; border-radius: 50px; font-size: 11px; font-weight: 700; color: white; text-transform: uppercase; letter-spacing: 0.5px;}
        .in-stock { background-color: #198754; } .out-of-stock { background-color: #dc3545; }

        .description-section { margin-bottom: 30px; }
        .description-title { font-size: 15px; font-weight: 700; color: #111; margin-bottom: 12px; display: block;}
        .description-content { font-size: 14px; color: #555; line-height: 1.7; }
        .description-content ul { padding: 0; margin: 0; }
        .description-content li { margin-bottom: 8px; position: relative; padding-left: 25px; list-style: none;}
        .description-content li::before { content: "\f00c"; font-family: "Font Awesome 6 Free"; font-weight: 900; color: var(--primary-color); position: absolute; left: 0; font-size: 13px; top: 3px;}

        .action-buttons { margin-top: auto; }
        
        /* Smaller WhatsApp Button */
        .buy-btn { 
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); color: white; padding: 12px 25px; border: none; 
            width: 100%; max-width: 320px; cursor: pointer; border-radius: 8px; font-size: 15px; font-weight: 700; 
            display: inline-flex; align-items: center; justify-content: center; gap: 10px; text-transform: uppercase; transition: 0.3s;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.2);
        }
        .buy-btn:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4); }
        .buy-btn:disabled { background: #ccc; cursor: not-allowed; box-shadow: none; color: #666;}

        /* --- SEO ARTICLE SECTION (Updated for Auto Formatting) --- */
        .seo-article-container { margin-top: 60px; padding-top: 40px; border-top: 1px solid var(--border-color); }
        .seo-article { max-width: 900px; color: #444; font-size: 14.5px; }
        
        /* Auto-generated Titles will take these styles */
        .seo-article h3 { 
            color: #111; 
            font-size: 18px; 
            margin-top: 30px; 
            margin-bottom: 12px; 
            font-weight: 700;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 5px;
            display: inline-block;
        }
        
        /* Auto-generated Paragraphs */
        .seo-article p { 
            margin-bottom: 18px; 
            line-height: 1.8;
            text-align: justify;
        }

        /* --- Standardized Footer --- */
        .main-footer { background-color: var(--dark-color); color: #999; padding: 30px 20px 20px; text-align: center; font-size: 13px; line-height: 1.8; margin-top: 60px;}
        .main-footer p { max-width: 800px; margin: 0 auto; }
        .main-footer strong { color: #fff; }
        
        /* Hidden SEO Text for Google Bots only */
        .seo-hidden-text { display: none; }
        
        .copyright { margin-top: 20px !important; border-top: 1px solid #333; padding-top: 20px; font-size: 12px;}

        /* Responsive */
        @media (max-width: 850px) {
            .product-layout { flex-direction: column; gap: 20px; }
            .product-gallery { width: 100%; max-width: 100%; flex-direction: column-reverse; }
            .thumbnail-list { flex-direction: row; width: 100%; justify-content: center; gap: 15px;}
            .thumbnail { width: 60px; height: 60px; }
            .product-info h1 { font-size: 24px; }
            .price { font-size: 26px; }
            .buy-btn { max-width: 100%; }
            .main-image-container { cursor: default; }
            .seo-article p { text-align: left; }
        }

        .loading-container { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 50vh; width: 100%;}
        .spinner { border: 3px solid rgba(0,0,0,0.1); width: 40px; height: 40px; border-radius: 50%; border-left-color: var(--primary-color); animation: spin 0.8s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <header>
        <a href="index.html" class="header-link">
            <h1>Ultra <span>Nutritions</span></h1>
            <p class="header-tagline">Top Rated Supplement Store in Sri Lanka</p>
        </a>
    </header>

    <div class="container" id="mainContent">
        <div class="loading-container">
            <div class="spinner"></div>
            <p style="margin-top: 15px; color: #888; font-size: 14px;">Loading Product Details...</p>
        </div>
    </div>

    <footer class="main-footer">
        <p><strong>Ultra Nutritions</strong> - Premium Online Supplement Store in Sri Lanka. 100% Authentic Products Guaranteed.</p>
        
        <div class="seo-hidden-text">
            We offer the best whey protein prices in Sri Lanka, including whey protein isolate and gold standard options. Whether you are searching for top 10 bodybuilding supplements in Colombo, Galle, or island-wide, we guarantee 100% authentic products. Compare our supplement prices in Sri Lanka and build your physique with confidence.
        </div>
        
        <p class="copyright">&copy; 2024 Ultra Nutritions. All Rights Reserved.</p>
    </footer>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyChnk_4ncFbSBkAPqEZQy0Bow-h2cVTLrs",
            authDomain: "ultranutritions.firebaseapp.com",
            projectId: "ultranutritions",
            storageBucket: "ultranutritions.firebasestorage.app",
            messagingSenderId: "904882148450",
            appId: "1:904882148450:web:c4784968cd03e63b3cad3b"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const MY_WHATSAPP_NUMBER = "94713640047";

        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('id');
        const contentDiv = document.getElementById("mainContent");

        if(!productId) {
            window.location.href = 'index.html';
        } else {
            db.collection("supplements").doc(productId).get().then((doc) => {
                if(doc.exists) {
                    renderProduct(doc.data());
                } else {
                    contentDiv.innerHTML = "<h2 style='text-align:center; padding: 50px 0;'>Product Not Found</h2>";
                }
            }).catch(err => {
                console.error(err);
                contentDiv.innerHTML = "<p style='text-align:center; padding: 50px 0;'>Error loading product. Please refresh.</p>";
            });
        }

        function renderProduct(item) {
            let isOutOfStock = (item.stockStatus === "Out of Stock");
            let images = [];
            if(item.image) images.push(item.image);
            if(item.image2) images.push(item.image2);
            if(images.length === 0) images.push("https://via.placeholder.com/600x600?text=No+Image");

            let descHTML = item.description ? "<ul>" + item.description.split('\n').map(line => line.trim() ? `<li>${line}</li>` : "").join('') + "</ul>" : "<p>Premium quality fitness supplement.</p>";
            let whatsappUrl = `https://wa.me/${MY_WHATSAPP_NUMBER}?text=${encodeURIComponent(`Hello Ultra Nutritions! I want to order:\n\n*Item:* ${item.name}\n*Price:* Rs. ${item.price}\n\nPlease confirm availability.`)}`;

            let seoArticleHTML = "";
            if (item.seoArticle && item.seoArticle.trim() !== "") {
                
                // --- Auto Format Logic ---
                let formattedSEO = item.seoArticle;
                
                // HTML Tags (p, br, h3) මුකුත් නැත්නම් විතරක් Auto Format කරනවා
                if (!formattedSEO.includes('<p>') && !formattedSEO.includes('<br>')) {
                    formattedSEO = formattedSEO.split(/\r?\n/).map(line => {
                        line = line.trim();
                        if (!line) return ""; // හිස් පේළි අයින් කරනවා
                        
                        // අකුරු 80කට වඩා අඩු, අගට තිතක් නැති පේළි Title විදිහට ගන්නවා
                        if (line.length < 80 && !line.endsWith('.')) {
                            return `<h3>${line}</h3>`;
                        } else {
                            // අනිත් ඒවා Paragraph විදිහට ගන්නවා
                            return `<p>${line}</p>`;
                        }
                    }).join('');
                }

                seoArticleHTML = `
                <div class="seo-article-container">
                    <article class="seo-article">
                        ${formattedSEO}
                    </article>
                </div>`;
            }

            let thumbnailHTML = "";
            if (images.length > 1) {
                thumbnailHTML = `<div class="thumbnail-list">
                    ${images.map((img, idx) => `
                        <div class="thumbnail ${idx === 0 ? 'active' : ''}" onclick="changeImage('${img}', this)">
                            <img src="${img}" alt="Thumbnail ${idx+1}">
                        </div>
                    `).join('')}
                </div>`;
            }

            contentDiv.innerHTML = `
                <a href="index.html" class="breadcrumb"><i class="fas fa-arrow-left"></i> Back to Products</a>
                
                <div class="product-layout">
                    <div class="product-gallery">
                        ${thumbnailHTML}
                        <div class="main-image-container" onmousemove="zoomImage(event, this)" onmouseleave="resetZoom(this)">
                            <img id="mainProductImage" src="${images[0]}" alt="${item.name}" style="${isOutOfStock ? 'opacity: 0.6; filter: grayscale(1);' : ''}">
                        </div>
                    </div>
                    
                    <div class="product-info">
                        <div><span class="cat-badge">${item.category || 'Supplement'}</span></div>
                        <h1>${item.name}</h1>
                        
                        <div class="price-section">
                            <p class="price">Rs. ${item.price}</p>
                            <div class="status-badge ${isOutOfStock ? 'out-of-stock' : 'in-stock'}">${item.stockStatus || 'In Stock'}</div>
                        </div>
                        
                        <div class="description-section">
                            <span class="description-title">Product Highlights</span>
                            <div class="description-content">${descHTML}</div>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="buy-btn" ${isOutOfStock ? 'disabled' : ''} onclick="window.open('${whatsappUrl}', '_blank')">
                                <i class="fab fa-whatsapp" style="font-size: 18px;"></i> ${isOutOfStock ? 'Currently Unavailable' : 'Order via WhatsApp'}
                            </button>
                        </div>
                    </div>
                </div>

                ${seoArticleHTML} `;
        }

        function changeImage(src, element) {
            document.getElementById('mainProductImage').src = src;
            document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
            element.classList.add('active');
        }

        function zoomImage(e, container) {
            if (window.innerWidth <= 850) return; 

            const img = container.querySelector('img');
            const rect = container.getBoundingClientRect();
            
            const x = ((e.clientX - rect.left) / rect.width) * 100;
            const y = ((e.clientY - rect.top) / rect.height) * 100;
            
            img.style.transformOrigin = `${x}% ${y}%`;
            img.style.transform = 'scale(2)';
        }

        function resetZoom(container) {
            if (window.innerWidth <= 850) return;

            const img = container.querySelector('img');
            img.style.transformOrigin = 'center center';
            img.style.transform = 'scale(1)';
        }
    </script>
</body>
</html>
